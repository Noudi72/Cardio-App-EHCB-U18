<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HIIT</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #222;
    color: #eee;
    margin: 0;
    padding: 0;
  }
  header {
    background: #d32f2f;
    padding: 1rem;
    text-align: center;
  }
  header h1 {
    margin: 0;
    font-size: 2rem;
  }
  main {
    max-width: 600px;
    margin: 1rem auto;
    padding: 1rem;
    background: #333;
    border-radius: 8px;
  }
  p.info {
    font-size: 1rem;
    margin-bottom: 1rem;
  }
  p.desc {
    font-size: 0.9rem;
    color: #ccc;
    margin-bottom: 2rem;
  }
  form {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
  }
  label {
    display: flex;
    flex-direction: column;
    font-size: 0.9rem;
  }
  input[type=number] {
    padding: 0.3rem;
    font-size: 1rem;
    border-radius: 4px;
    border: none;
    outline: none;
  }
  button {
    grid-column: span 2;
    background: #d32f2f;
    color: white;
    border: none;
    padding: 0.75rem;
    font-size: 1.1rem;
    border-radius: 4px;
    cursor: pointer;
  }
  button:disabled {
    background: #a53939;
    cursor: not-allowed;
  }
  .timer {
    font-size: 3rem;
    text-align: center;
    margin: 2rem 0;
  }
  .phase {
    font-size: 1.5rem;
    text-align: center;
    margin-bottom: 1rem;
  }
  .audio-controls {
    text-align: center;
    margin-top: 1rem;
  }
  .audio-controls button {
    background: #444;
    margin: 0 0.5rem;
    padding: 0.5rem 1rem;
    font-size: 1rem;
    border-radius: 4px;
  }
  /* Modal styles */
  .modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0; top: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.7);
    justify-content: center;
    align-items: center;
  }
  .modal-content {
    background: #444;
    padding: 1.5rem;
    border-radius: 8px;
    max-width: 400px;
    width: 90%;
    color: #eee;
  }
  .modal-content h2 {
    margin-top: 0;
    color: #d32f2f;
  }
  .modal-content table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 1rem;
  }
  .modal-content th, .modal-content td {
    border: 1px solid #666;
    padding: 0.5rem;
    text-align: center;
  }
  .modal-content th {
    background: #d32f2f;
    color: white;
  }
  .modal-close {
    background: #d32f2f;
    border: none;
    color: white;
    padding: 0.5rem 1rem;
    cursor: pointer;
    border-radius: 4px;
    float: right;
  }
  @media (max-width: 480px) {
    form {
      grid-template-columns: 1fr;
    }
    button {
      grid-column: span 1;
    }
  }
</style>
</head>
<body>
<header>
  <h1>HIIT</h1>
</header>
<main>
  <p class="info">High-intensity interval training for maximum fat burning and performance.</p>
  <p class="desc">Efficient intervals: 10 min warm up, 10Ã— (45s work / 60s rest), 10 min cool down. Adjust sets, cycles and times for your needs.</p>
  <form id="intervalForm" aria-label="HIIT interval settings">
    <label for="prepare">Prepare (seconds):
      <input type="number" id="prepare" name="prepare" min="0" max="600" value="20" />
    </label>
    <label for="sets">Sets:
      <input type="number" id="sets" name="sets" min="1" max="10" value="1" />
    </label>
    <label for="cycles">Cycles/Set:
      <input type="number" id="cycles" name="cycles" min="1" max="20" value="10" />
    </label>
    <label for="work">Work (seconds):
      <input type="number" id="work" name="work" min="1" max="600" value="45" />
    </label>
    <label for="rest">Rest (seconds):
      <input type="number" id="rest" name="rest" min="1" max="600" value="60" />
    </label>
    <label for="relax">Relax (seconds):
      <input type="number" id="relax" name="relax" min="0" max="3600" value="600" />
    </label>
    <button type="submit" id="startBtn">Start</button>
  </form>
  <div class="timer" aria-live="polite" aria-atomic="true" id="timerDisplay">00:00</div>
  <div class="phase" id="phaseDisplay" aria-live="polite" aria-atomic="true"></div>
  <div class="audio-controls">
    <button id="soundOnBtn" aria-pressed="false" aria-label="Enable sound">Sound On</button>
    <button id="soundOffBtn" aria-pressed="true" aria-label="Disable sound" hidden>Sound Off</button>
    <button id="infoBtn" aria-label="Show phase information">Phase Info</button>
  </div>
</main>
<div class="modal" id="infoModal" role="dialog" aria-modal="true" aria-labelledby="infoModalTitle" aria-describedby="infoModalDesc">
  <div class="modal-content">
    <button class="modal-close" id="modalCloseBtn" aria-label="Close phase information modal">&times;</button>
    <h2 id="infoModalTitle">Phase Information</h2>
    <p id="infoModalDesc">Details about intensity, RPM and heart rate for each phase.</p>
    <table>
      <thead>
        <tr>
          <th>Phase</th>
          <th>Intensity</th>
          <th>RPM</th>
          <th>HR (%)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Prepare</td>
          <td>Low</td>
          <td>70-80</td>
          <td>50-60</td>
        </tr>
        <tr>
          <td>Work</td>
          <td>Max</td>
          <td>100-110</td>
          <td>85-100</td>
        </tr>
        <tr>
          <td>Rest</td>
          <td>Low</td>
          <td>60-70</td>
          <td>50-60</td>
        </tr>
        <tr>
          <td>Relax</td>
          <td>Low</td>
          <td>60</td>
          <td>40-50</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
<script>
  (function(){
    const form = document.getElementById('intervalForm');
    const timerDisplay = document.getElementById('timerDisplay');
    const phaseDisplay = document.getElementById('phaseDisplay');
    const startBtn = document.getElementById('startBtn');
    const soundOnBtn = document.getElementById('soundOnBtn');
    const soundOffBtn = document.getElementById('soundOffBtn');
    const infoBtn = document.getElementById('infoBtn');
    const infoModal = document.getElementById('infoModal');
    const modalCloseBtn = document.getElementById('modalCloseBtn');

    let timer = null;
    let totalSeconds = 0;
    let currentPhase = 0;
    let phases = [];
    let isRunning = false;
    let soundEnabled = true;

    // Audio setup
    const beepLow = new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAgD4AAAB9AAACABAAZGF0YQAAAAA='); // placeholder silent audio
    const beepHigh = new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAgD4AAAB9AAACABAAZGF0YQAAAAA='); // placeholder silent audio

    function formatTime(seconds) {
      const m = Math.floor(seconds / 60);
      const s = seconds % 60;
      return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }

    function buildPhases(prepare, sets, cycles, work, rest, relax) {
      const phasesArr = [];
      if(prepare > 0) phasesArr.push({name:'Prepare', duration:prepare});
      for(let s=0; s<sets; s++) {
        for(let c=0; c<cycles; c++) {
          phasesArr.push({name:'Work', duration: work});
          phasesArr.push({name:'Rest', duration: rest});
        }
      }
      if(relax > 0) phasesArr.push({name:'Relax', duration: relax});
      return phasesArr;
    }

    function getPhaseSound(phaseName) {
      // Placeholder: different beep for work phase
      if(phaseName === 'Work') return beepHigh;
      return beepLow;
    }

    function updatePhaseDisplay(name) {
      phaseDisplay.textContent = name;
    }

    function playBeep(phaseName) {
      if(!soundEnabled) return;
      const sound = getPhaseSound(phaseName);
      if(sound) {
        sound.pause();
        sound.currentTime = 0;
        sound.play();
      }
    }

    function startTimer() {
      if(isRunning) return;
      const prepare = parseInt(form.prepare.value,10);
      const sets = parseInt(form.sets.value,10);
      const cycles = parseInt(form.cycles.value,10);
      const work = parseInt(form.work.value,10);
      const rest = parseInt(form.rest.value,10);
      const relax = parseInt(form.relax.value,10);

      phases = buildPhases(prepare, sets, cycles, work, rest, relax);
      if(phases.length === 0) return;

      currentPhase = 0;
      totalSeconds = phases[0].duration;
      updatePhaseDisplay(phases[0].name);
      timerDisplay.textContent = formatTime(totalSeconds);
      playBeep(phases[0].name);

      isRunning = true;
      startBtn.disabled = true;
      form.querySelectorAll('input').forEach(i => i.disabled = true);

      timer = setInterval(() => {
        totalSeconds--;
        timerDisplay.textContent = formatTime(totalSeconds);
        if(totalSeconds <= 0) {
          currentPhase++;
          if(currentPhase >= phases.length) {
            clearInterval(timer);
            isRunning = false;
            startBtn.disabled = false;
            form.querySelectorAll('input').forEach(i => i.disabled = false);
            updatePhaseDisplay('Done');
            return;
          }
          totalSeconds = phases[currentPhase].duration;
          updatePhaseDisplay(phases[currentPhase].name);
          playBeep(phases[currentPhase].name);
          timerDisplay.textContent = formatTime(totalSeconds);
        }
      }, 1000);
    }

    function stopTimer() {
      if(timer) {
        clearInterval(timer);
        timer = null;
      }
      isRunning = false;
      startBtn.disabled = false;
      form.querySelectorAll('input').forEach(i => i.disabled = false);
      updatePhaseDisplay('');
      timerDisplay.textContent = '00:00';
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      if(!isRunning) {
        startTimer();
      } else {
        stopTimer();
      }
    });

    soundOnBtn.addEventListener('click', () => {
      soundEnabled = true;
      soundOnBtn.hidden = true;
      soundOffBtn.hidden = false;
      soundOnBtn.setAttribute('aria-pressed', 'true');
      soundOffBtn.setAttribute('aria-pressed', 'false');
    });
    soundOffBtn.addEventListener('click', () => {
      soundEnabled = false;
      soundOnBtn.hidden = false;
      soundOffBtn.hidden = true;
      soundOnBtn.setAttribute('aria-pressed', 'false');
      soundOffBtn.setAttribute('aria-pressed', 'true');
    });

    infoBtn.addEventListener('click', () => {
      infoModal.style.display = 'flex';
      modalCloseBtn.focus();
    });

    modalCloseBtn.addEventListener('click', () => {
      infoModal.style.display = 'none';
      infoBtn.focus();
    });

    window.addEventListener('keydown', (e) => {
      if(e.key === 'Escape' && infoModal.style.display === 'flex') {
        infoModal.style.display = 'none';
        infoBtn.focus();
      }
    });
  })();
</script>
</body>
</html>
